<div class="mx-auto max-w-xl p-6">
  <h1 class="text-2xl font-semibold">Nap Alarm</h1>
  <% if flash[:alert] %>
    <p class="mt-3 text-red-600"><%= flash[:alert] %></p>
  <% end %>
  <%= form_with url: alarm_path, method: :post, local: true, class: "mt-6 space-y-6" do |f| %>
    <fieldset class="space-y-2">
      <legend class="font-medium">時間（どれにする？）</legend>
      <div class="flex flex-wrap gap-4">
        <label class="inline-flex items-center gap-2"><%= radio_button_tag :preset, "15", true %><span>15分</span></label>
        <label class="inline-flex items-center gap-2"><%= radio_button_tag :preset, "20" %><span>20分</span></label>
        <label class="inline-flex items-center gap-2"><%= radio_button_tag :preset, "30" %><span>30分</span></label>
        <label class="inline-flex items-center gap-2"><%= radio_button_tag :preset, "45" %><span>45分</span></label>
        <label class="inline-flex items-center gap-2"><%= radio_button_tag :preset, "60" %><span>60分</span></label>
        <label class="inline-flex items-center gap-2">
          <%= radio_button_tag :preset, "custom" %><span>カスタム</span>
          <div class="ml-2 inline-flex items-center gap-2">
            <%= number_field_tag :custom_hours, 0, min: 0, max: 24, step: 1, class: "w-16 border rounded px-2 py-1" %><span>時間</span>
            <%= number_field_tag :custom_minutes, 0, min: 0, max: 59, step: 1, class: "w-16 border rounded px-2 py-1" %><span>分</span>
          </div>
        </label>
      </div>
    </fieldset>
    <fieldset class="space-y-2" data-controller="alarm-form">
      <legend class="font-medium">音楽URL（任意）</legend>
      <p class="text-sm text-gray-600">直リンク推奨。開始ボタンは必ず押してね（自動再生規制）。</p>
      <div class="flex items-center gap-3">
        <%= url_field_tag :music_url, nil,
      placeholder: "https://example.com/alarm.mp3",
      class: "w-full border rounded px-3 py-2",
      data: { "alarm-form-target": "musicUrl" } %>
        <button type="button"
            class="inline-flex items-center justify-center rounded border px-3 py-2 hover:bg-gray-50"
            data-action="alarm-form#testSound">
          音をテスト
        </button>
        <button type="button"
            class="inline-flex items-center justify-center rounded border px-3 py-2 hover:bg-gray-50"
            data-action="alarm-form#stopTest">
          停止
        </button>
        <div class="flex items-center gap-3 mt-2">
          <label class="text-sm text-gray-600">音量</label>
          <input type="range" min="0" max="1" step="0.01" value="1"
         class="w-full"
         data-alarm-form-target="volume"
         data-action="input->alarm-form#volumeChanged">
          <span class="text-sm text-gray-600" data-alarm-form-target="volLabel">100%</span>
        </div>
      </div>
      <div class="mt-4">
        <h2 class="font-medium">直近10件</h2>
        <ul class="space-y-2" data-alarm-form-target="historyList"></ul>
        <button type="button"
            class="mt-2 inline-flex items-center justify-center rounded border px-3 py-2 hover:bg-gray-50"
            data-action="alarm-form#clearHistory">
          履歴クリア
        </button>
      </div>
    </fieldset>
    <%= f.submit "アラーム開始へ", class: "inline-flex items-center justify-center rounded border px-4 py-2 hover:bg-gray-50" %>
  <% end %>
</div>
